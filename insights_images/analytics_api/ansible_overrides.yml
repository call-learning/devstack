---
#
# From edX Configuration
#
# github:     https://github.com/edx/configuration
# wiki:       https://openedx.atlassian.net/wiki/display/OpenOPS
# code style: https://openedx.atlassian.net/wiki/display/OpenOPS/Ansible+Code+Conventions
# license:    https://github.com/edx/configuration/blob/master/LICENSE.TXT
#
##
# Defaults for role analytics_api in the context of the devstack
#


ANALYTICS_API_REPOS:
  - PROTOCOL: "{{ COMMON_GIT_PROTOCOL }}"
    DOMAIN: "{{ COMMON_GIT_MIRROR }}"
    PATH: "{{ COMMON_GIT_PATH }}"
    REPO: edx-analytics-data-api.git
    VERSION: "{{ (ANALYTICS_API_VERSION == \"master\") | ternary('','open-release/') }}{{ ANALYTICS_API_VERSION }}"
    DESTINATION: "{{ analytics_api_code_dir }}"
    SSH_KEY: "{{ ANALYTICS_API_GIT_IDENTITY }}"


analytics_api_service_config_overrides:
  API_AUTH_TOKEN: '{{ ANALYTICS_API_AUTH_TOKEN }}'
  STATICFILES_DIRS: ['static']
  STATIC_ROOT: "{{ COMMON_DATA_DIR }}/{{ analytics_api_service_name }}/staticfiles"
  LMS_BASE_URL: "{{ ANALYTICS_API_LMS_BASE_URL | default('http://127.0.0.1:8000/') }}"

  # db config
  ANALYTICS_DATABASE: '{{ ANALYTICS_DB_CONFIG_ALIAS }}'
  DATABASES: '{{ ANALYTICS_API_DATABASES }}'
  ELASTICSEARCH_LEARNERS_HOST: '{{ ANALYTICS_API_ELASTICSEARCH_LEARNERS_HOST }}'
  ELASTICSEARCH_LEARNERS_INDEX: '{{ ANALYTICS_API_ELASTICSEARCH_LEARNERS_INDEX }}'
  ELASTICSEARCH_LEARNERS_UPDATE_INDEX: '{{ ANALYTICS_API_ELASTICSEARCH_LEARNERS_UPDATE_INDEX }}'
  ELASTICSEARCH_CONNECTION_CLASS: '{{ ANALYTICS_API_ELASTICSEARCH_CONNECTION_CLASS }}'
  ELASTICSEARCH_AWS_ACCESS_KEY_ID: '{{ ANALYTICS_API_ELASTICSEARCH_AWS_ACCESS_KEY_ID }}'
  ELASTICSEARCH_AWS_SECRET_ACCESS_KEY: '{{ ANALYTICS_API_ELASTICSEARCH_AWS_SECRET_ACCESS_KEY }}'
  ELASTICSEARCH_CONNECTION_DEFAULT_REGION: '{{ ANALYTICS_API_ELASTICSEARCH_CONNECTION_DEFAULT_REGION }}'
  DATE_FORMAT: '{{ ANALYTICS_API_DATE_FORMAT }}'
  DATETIME_FORMAT: '{{ ANALYTICS_API_DATETIME_FORMAT }}'
  DEFAULT_PAGE_SIZE: '{{ ANALYTICS_API_DEFAULT_PAGE_SIZE }}'
  MAX_PAGE_SIZE: '{{ ANALYTICS_API_MAX_PAGE_SIZE }}'
  AGGREGATE_PAGE_SIZE: '{{ ANALYTICS_API_AGGREGATE_PAGE_SIZE }}'
  REPORT_DOWNLOAD_BACKEND: '{{ ANALYTICS_API_REPORT_DOWNLOAD_BACKEND }}'
  CSRF_COOKIE_SECURE: "{{ ANALYTICS_API_CSRF_COOKIE_SECURE }}"

  JWT_AUTH:
    JWT_ISSUERS:
    -   AUDIENCE: SET-ME-PLEASE
        ISSUER: "{{ ANALYTICS_API_LMS_BASE_URL }}/oauth2"
        SECRET_KEY: "{{ ANALYTICS_API_SECRET_KEY }}"
    JWT_PUBLIC_SIGNING_JWK_SET: None
  SOCIAL_AUTH_EDX_OIDC_ISSUER: "{{ ANALYTICS_API_LMS_BASE_URL }}/oauth2"
  SOCIAL_AUTH_EDX_OIDC_KEY: "analytics_api-key"
  SOCIAL_AUTH_EDX_OIDC_LOGOUT_URL:  "{{ ANALYTICS_API_LMS_BASE_URL }}/logout"
  SOCIAL_AUTH_EDX_OIDC_PUBLIC_URL_ROOT:  "{{ ANALYTICS_API_LMS_BASE_URL }}/oauth2"
  SOCIAL_AUTH_EDX_OIDC_SECRET: analytics_api-secret
  SOCIAL_AUTH_EDX_OIDC_URL_ROOT:  "{{ ANALYTICS_API_LMS_BASE_URL }}/oauth2"
